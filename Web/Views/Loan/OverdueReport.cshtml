@model Application.Common.PagedResult<Application.DTOs.LoanBasicDto>
@{
    ViewData["Title"] = "Overdue Loans Report";
}
<h2 class="text-3xl font-bold mb-6">Overdue Loans Report</h2>
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

<div class="bg-white shadow-md rounded-lg overflow-hidden mb-6">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Member
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Contact
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Book
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Due Date
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Days Overdue
                </th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            @if (!Model.Items.Any())
            {
                <tr>
                    <td colspan="5" class="px-6 py-4 text-center text-gray-500">No overdue loans found.</td>
                </tr>
            }
            @foreach (var loan in Model.Items)
            {
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">@loan.MemberName</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div><strong>Email:</strong> @loan.MemberEmail</div>
                        @if (!string.IsNullOrEmpty(loan.MemberPhone))
                        {
                            <div><strong>Phone:</strong> @loan.MemberPhone</div>
                        }
                        @if (!string.IsNullOrEmpty(loan.MemberAddress))
                        {
                            <div><strong>Address:</strong> @loan.MemberAddress</div>
                        }
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">@loan.BookTitle</td>
                    <td class="px-6 py-4 whitespace-nowrap">@loan.DueDate.ToString("yyyy-MM-dd")</td>
                    <td class="px-6 py-4 whitespace-nowrap">@loan.DaysOverdue</td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div class="flex gap-4">
    <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
        <a asp-action="Index">
            Back to List
        </a>
    </button>
    <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
        <a asp-action="DownloadOverdueReportCsv">
            Export CSV
        </a>
    </button>
</div>

@if (Model.TotalPages > 1)
{
    <nav>
        <ul class="pagination">
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(i == Model.Page ? "active" : "")">
                    <a class="page-link" asp-action="OverdueReport" asp-route-page="@i" asp-route-pageSize="@Model.PageSize">@i</a>
                </li>
            }
        </ul>
    </nav>
}